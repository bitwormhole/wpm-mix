"use strict";(self["webpackChunkwpm_station_vue"]=self["webpackChunkwpm_station_vue"]||[]).push([[128],{1128:function(e,t,l){l.d(t,{Z:function(){return O}});var n=l(3396);function a(e,t,l,a,i,o){const r=(0,n.up)("MyDialogCommon");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n.Wm)(r,{modelValue:l.modelValue,bank:"dialog_open",multipleSelection:l.multipleSelection,"onUpdate:modelValue":o.updateModelValue,onOpenFile:o.handleOpenFile},null,8,["modelValue","multipleSelection","onUpdate:modelValue","onOpenFile"])])}var i=l(4870),o=l(7139),r=l(2748),s=(l(7658),l(9242));const u={class:"mode-elements"},m={class:"mode-input"},d={name:"filebrowser-path-bar",computed:{items(){return this.makeItems(this.elements)},elements(){return this.$store.getters["files/GetPathElements"](this.bank)}},data(){return{mode:{current:2,edit:1,elements:2},pathText:""}},methods:{handleClickEdit(){let e=this.bank,t=this.$store.getters["files/GetPathString"](e);null==t&&(t=""),this.pathText=t,this.mode.current=this.mode.edit},handleClickGo(){this.mode.current=this.mode.elements,this.navTo(this.pathText)},handleClickCancel(){this.mode.current=this.mode.elements},handleClickPathItem(e){let t=e.path;this.navTo(t)},handleClickPathRoot(){this.navTo("/")},makeItems(e){let t=[],l="";for(var n in e){let a=e[n],i=this.makeItem(a,l);t.push(i),l=i.path}return t},makeItem(e,t){let l={};return l.path=t+"/"+e,l.name=e,l},navTo(e){let t=this.bank;this.$store.dispatch("files/fetch",{bank:t,path:e})}},props:{bank:String}};var h=Object.assign(d,{setup(e){return(e,t)=>{const l=(0,n.up)("el-button"),a=(0,n.up)("el-breadcrumb-item"),d=(0,n.up)("el-breadcrumb"),h=(0,n.up)("el-icon"),c=(0,n.up)("el-input");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n.wy)((0,n._)("div",u,[(0,n.Wm)(d,{class:"mode-elements-bread","separator-icon":(0,i.SU)(r.olP)},{default:(0,n.w5)((()=>[(0,n.Wm)(a,null,{default:(0,n.w5)((()=>[(0,n.Wm)(l,{class:"path-element",link:"",type:"primary",onClick:e.handleClickPathRoot},{default:(0,n.w5)((()=>[(0,n.Uk)(" 根 ")])),_:1},8,["onClick"])])),_:1}),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.items,(t=>((0,n.wg)(),(0,n.j4)(a,{key:t.id},{default:(0,n.w5)((()=>[(0,n.Wm)(l,{class:"path-element",link:"",type:"primary",title:t.path,onClick:l=>e.handleClickPathItem(t)},{default:(0,n.w5)((()=>[(0,n.Uk)((0,o.zw)(t.name),1)])),_:2},1032,["title","onClick"])])),_:2},1024)))),128))])),_:1},8,["separator-icon"]),(0,n.Wm)(l,{link:"",onClick:e.handleClickEdit,title:"编辑路径"},{default:(0,n.w5)((()=>[(0,n.Wm)(h,null,{default:(0,n.w5)((()=>[(0,n.Wm)((0,i.SU)(r.I8b))])),_:1})])),_:1},8,["onClick"])],512),[[s.F8,e.mode.current==e.mode.elements]]),(0,n.wy)((0,n._)("div",m,[(0,n.Wm)(c,{modelValue:e.pathText,"onUpdate:modelValue":t[0]||(t[0]=t=>e.pathText=t),placeholder:"请输入要查询的路径"},{prepend:(0,n.w5)((()=>[(0,n.Wm)(l,{onClick:e.handleClickCancel,title:"取消"},{default:(0,n.w5)((()=>[(0,n.Wm)(h,null,{default:(0,n.w5)((()=>[(0,n.Wm)((0,i.SU)(r.q6s))])),_:1})])),_:1},8,["onClick"])])),append:(0,n.w5)((()=>[(0,n.Wm)(l,{onClick:e.handleClickGo,title:"查询"},{default:(0,n.w5)((()=>[(0,n.Wm)(h,null,{default:(0,n.w5)((()=>[(0,n.Wm)((0,i.SU)(r.O6d))])),_:1})])),_:1},8,["onClick"])])),_:1},8,["modelValue"])],512),[[s.F8,e.mode.current==e.mode.edit]])])}}}),c=l(89);const p=(0,c.Z)(h,[["__scopeId","data-v-44e24e86"]]);var f=p;function k(e,t,l,a,i,r){const s=(0,n.up)("el-table-column"),u=(0,n.up)("el-button"),m=(0,n.up)("el-table");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n.Wm)(m,{data:r.items,ref:"theTable","highlight-current-row":"",onSelectionChange:r.handleSelectionChange,onCurrentChange:r.handleCurrentChange},{default:(0,n.w5)((()=>[(0,n.Wm)(s,{type:r.tableColumnType},null,8,["type"]),(0,n.Wm)(s,{prop:"name",label:"名称",sortable:""},{default:(0,n.w5)((e=>[(0,n.Wm)(u,{link:"",type:"primary",onClick:t=>r.handleClickItemName(e.row)},{default:(0,n.w5)((()=>[(0,n.Uk)((0,o.zw)(e.row.name),1)])),_:2},1032,["onClick"])])),_:1}),(0,n.Wm)(s,{prop:"content_type",label:"类型",sortable:""}),(0,n.Wm)(s,{prop:"updated_at",label:"修改时间",formatter:r.formatTimestamp,sortable:""},null,8,["formatter"]),(0,n.Wm)(s,{prop:"size",label:"大小",formatter:r.formatByteSize,sortable:""},null,8,["formatter"])])),_:1},8,["data","onSelectionChange","onCurrentChange"])])}function C(e,t){let l=e+"";if(e<0)return l;if(null==t)return l;if(t<2)return l;for(;l.length<t;)l="0"+l;return l}function b(e){let t=new Date;t.setTime(e);let l=t.getFullYear(),n=t.getMonth()+1,a=t.getDate(),i=t.getHours(),o=t.getMinutes(),r=t.getSeconds(),s=""+l;return s+="-"+C(n,2),s+="-"+C(a,2),s+="  "+C(i,2),s+=":"+C(o,2),s+=":"+C(r,2),s}var g={name:"TimeJS",StringifyTimestamp:b};function w(e,t,l){let n=e/t;if(n<1)return null;let a="";return a=n<5?n.toFixed(1):n.toFixed(0),a+l}function S(e){const t=1024,l=1048576,n=1073741824;let a=w(e,n," GB");return null!=a?a:(a=w(e,l," MB"),null!=a?a:(a=w(e,t," KB"),null!=a?a:e+" B"))}var _={name:"BytesJS",StringifySize:S};function v(){}var W={name:"filebrowser-view-detail-table",computed:{items(){return this.$store.getters["files/GetItems"](this.bank)},tableColumnType(){return this.multipleSelection?"selection":"index"}},data(){return{selection1:{},selectionN:[]}},methods:{handleClickItemName(e){e.is_dir&&this.openDir(e)},openDir(e){let t=this.bank,l=e.name;this.$store.dispatch("files/fetch",{bank:t,href:l})},getFieldByName(e,t){return null==e||null==t?"":t[e]},handleCurrentChange(e){null!=e&&(this.selection1=e),this.fireSelectionChange()},handleSelectionChange(){let e=this.$refs.theTable.getSelectionRows();null!=e&&(this.selectionN=e),this.fireSelectionChange()},fireSelectionChange(){let e=this.selectionN,t=this.selection1,l=[];if(null!=e)for(var n in e)l.push(e[n]);0==l.length&&null!=t&&null!=t.name&&l.push(t),this.$emit("selection-change",l)},formatByteSize(e,t,l,n){return v(e,t,n),_.StringifySize(l)},formatTimestamp(e,t,l,n){return v(e,t,n),g.StringifyTimestamp(l)}},props:{bank:String,multipleSelection:Boolean}};const y=(0,c.Z)(W,[["render",k]]);var T=y,V=l(2655);const U=e=>((0,n.dD)("data-v-2a3b2d19"),e=e(),(0,n.Cn)(),e),B={class:"toolbar toolbar-top"},I=U((()=>(0,n._)("div",{class:"toolbar toolbar-bottom"},null,-1))),x={name:"filebrowser-dialog-common",components:{MyPathBar:f,MyDetailView:T},computed:{dialogTitle(){let e=this.title;if(null!=e&&""!=e)return e;let t=this.actionText,l=this.wantText;return t+l},actionText(){let e=this.action;return"save"==e?"保存":"打开"},wantText(){let e=this.want;return"folder"==e||"directory"==e?"文件夹":"文件"}},data(){return{filename:"",selectedItems:[]}},methods:{refresh(){let e=this.bank;this.$store.dispatch("files/fetch",{bank:e})},updateModelValue(e){this.$emit("update:modelValue",e)},handleClickRefresh(){this.refresh()},handleClickGoUp(){let e=this.bank,t="..";this.$store.dispatch("files/fetch",{bank:e,href:t})},handleClickMakeDir(){let e="新建文件夹",t="请输入文件夹名称";V.T.prompt(t,e,{confirmButtonText:"确定",cancelButtonText:"取消"}).then((()=>{console.warn("todo: mkdir")})).catch((()=>{}))},handleClickCancel(){this.updateModelValue(!1)},handleClickOK(){this.updateModelValue(!1);let e=this.selectedItems;"save"==this.action?this.$emit("save-file",e):this.$emit("open-file",e)},handleSelectionChange(e){if(null==e)return;if(1==e.length)return this.filename=e[0].name,void(this.selectedItems=e);let t="",l="";for(var n in e){let a=e[n];l+=t+"'"+a.name+"'",t=", "}this.selectedItems=e,this.filename=l},init(){let e="/",t="file:///",l=this.bank;this.$store.commit("files/init",{bank:l,path:e,base:t})}},mounted(){this.init()},props:{modelValue:Boolean,bank:String,title:String,want:String,action:String,multipleSelection:Boolean},watch:{modelValue(e,t){1==e&&0==t&&this.refresh()}}};var D=Object.assign(x,{setup(e){return(t,l)=>{const a=(0,n.up)("el-icon"),s=(0,n.up)("el-button"),u=(0,n.up)("el-input"),m=(0,n.up)("el-dialog");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n.Wm)(m,{modelValue:e.modelValue,"onUpdate:modelValue":t.updateModelValue,width:"66%",fullscreen:!1,title:t.dialogTitle},{default:(0,n.w5)((()=>[(0,n.Wm)(f,{bank:e.bank},null,8,["bank"]),(0,n._)("div",B,[(0,n.Wm)(s,{onClick:t.handleClickGoUp},{default:(0,n.w5)((()=>[(0,n.Wm)(a,null,{default:(0,n.w5)((()=>[(0,n.Wm)((0,i.SU)(r.tYz))])),_:1}),(0,n.Uk)(" 向上 ")])),_:1},8,["onClick"]),(0,n.Wm)(s,{onClick:t.handleClickRefresh},{default:(0,n.w5)((()=>[(0,n.Wm)(a,null,{default:(0,n.w5)((()=>[(0,n.Wm)((0,i.SU)(r.hYj))])),_:1}),(0,n.Uk)(" 刷新")])),_:1},8,["onClick"]),(0,n.Wm)(s,{onClick:t.handleClickMakeDir},{default:(0,n.w5)((()=>[(0,n.Wm)(a,null,{default:(0,n.w5)((()=>[(0,n.Wm)((0,i.SU)(r.v37))])),_:1}),(0,n.Uk)(" 新建文件夹")])),_:1},8,["onClick"]),(0,n.Wm)(u,{class:"input-file-name",modelValue:t.filename,"onUpdate:modelValue":l[0]||(l[0]=e=>t.filename=e),placeholder:"文件(或目录)名"},null,8,["modelValue"]),(0,n.Wm)(s,{type:"success",onClick:t.handleClickOK},{default:(0,n.w5)((()=>[(0,n.Uk)((0,o.zw)(t.actionText),1)])),_:1},8,["onClick"]),(0,n.Wm)(s,{type:"default",onClick:t.handleClickCancel},{default:(0,n.w5)((()=>[(0,n.Uk)("取消")])),_:1},8,["onClick"])]),(0,n.Wm)(T,{bank:e.bank,onSelectionChange:t.handleSelectionChange},null,8,["bank","onSelectionChange"]),I])),_:1},8,["modelValue","onUpdate:modelValue","title"])])}}});const M=(0,c.Z)(D,[["__scopeId","data-v-2a3b2d19"]]);var $=M,F={name:"filebrowser-dialog-open",components:{MyDialogCommon:$},methods:{updateModelValue(e){this.$emit("update:modelValue",e)},handleOpenFile(e){this.$emit("open-file",e)}},props:{modelValue:Boolean,multipleSelection:Boolean}};const z=(0,c.Z)(F,[["render",a]]);var O=z}}]);
//# sourceMappingURL=128.01c6611f.js.map