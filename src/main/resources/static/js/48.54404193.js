"use strict";(self["webpackChunkwpm_station_vue"]=self["webpackChunkwpm_station_vue"]||[]).push([[48],{8048:function(e,t,a){a.r(t),a.d(t,{default:function(){return R}});var n=a(3396);function l(e,t,a,l,i,r){const s=(0,n.up)("ClientViewIndex"),o=(0,n.up)("AdminFrame");return(0,n.wg)(),(0,n.j4)(o,null,{default:(0,n.w5)((()=>[(0,n.Wm)(s)])),_:1})}const i=e=>((0,n.dD)("data-v-4e7e347c"),e=e(),(0,n.Cn)(),e),r={class:"settings-mediae-index-page"},s=i((()=>(0,n._)("h1",null,"媒体",-1)));function o(e,t,a,l,i,o){const u=(0,n.up)("MyToolbar"),d=(0,n.up)("MyPager"),m=(0,n.up)("MyTable"),p=(0,n.up)("MyUpImageDialog");return(0,n.wg)(),(0,n.iD)("div",r,[s,(0,n.Wm)(u,{onAction:o.handleAction},null,8,["onAction"]),(0,n.Wm)(d,{class:"settings-mediae-index-pager"}),(0,n.Wm)(m),(0,n.Wm)(p,{modelValue:i.displayUploadDialog,"onUpdate:modelValue":t[0]||(t[0]=e=>i.displayUploadDialog=e)},null,8,["modelValue"])])}var u=a(4870),d=a(2748);const m={class:"toolbar"},p={name:"settings-mediae-toolbar",methods:{fire(e){let t={name:e};this.$emit("action",t)},insert(){this.fire("insert")},refresh(){this.fire("refresh")},importPresets(){this.fire("import-presets")}}};var c=Object.assign(p,{setup(e){return(e,t)=>{const a=(0,n.up)("el-icon"),l=(0,n.up)("el-button");return(0,n.wg)(),(0,n.iD)("div",m,[(0,n.Wm)(l,{type:"default",onClick:e.refresh},{default:(0,n.w5)((()=>[(0,n.Wm)(a,null,{default:(0,n.w5)((()=>[(0,n.Wm)((0,u.SU)(d.hYj))])),_:1}),(0,n.Uk)(" 刷新 ")])),_:1},8,["onClick"]),(0,n.Wm)(l,{type:"default",onClick:e.insert},{default:(0,n.w5)((()=>[(0,n.Wm)(a,null,{default:(0,n.w5)((()=>[(0,n.Wm)((0,u.SU)(d.v37))])),_:1}),(0,n.Uk)(" 添加 ")])),_:1},8,["onClick"]),(0,n.Wm)(l,{type:"default",onClick:e.importPresets},{default:(0,n.w5)((()=>[(0,n.Wm)(a,null,{default:(0,n.w5)((()=>[(0,n.Wm)((0,u.SU)(d.v37)),(0,n.Uk)(),(0,n.Wm)((0,u.SU)(d.v37))])),_:1}),(0,n.Uk)(" 导入预置资源 ")])),_:1},8,["onClick"])])}}}),g=a(89);const h=(0,g.Z)(c,[["__scopeId","data-v-0ce938ae"]]);var f=h;function v(e,t,a,l,i,r){const s=(0,n.up)("el-pagination");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n.Wm)(s,{"current-page":i.currentPage,"onUpdate:currentPage":t[0]||(t[0]=e=>i.currentPage=e),"page-size":i.pageSize,"onUpdate:pageSize":t[1]||(t[1]=e=>i.pageSize=e),"page-sizes":[5,10,20,50,100,200,500],background:i.background,layout:"total, sizes, prev, pager, next",total:r.theCountItemsTotal,onSizeChange:r.handleSizeChange,onCurrentChange:r.handleCurrentChange},null,8,["current-page","page-size","background","total","onSizeChange","onCurrentChange"])])}var w={name:"settings-mediae-pager",computed:{theCountItemsTotal(){return this.$store.getters["media/total"]}},data(){return{currentPage:1,pageSize:10,background:!0}},methods:{handleSizeChange(e){let t=e,a=0;this.$store.commit("media/update",{index:a,size:t})},handleCurrentChange(e){let t=e-1;this.$store.commit("media/update",{index:t})}}};const b=(0,g.Z)(w,[["render",v]]);var _=b;const k=["src"];function C(e,t,a,l,i,r){const s=(0,n.up)("el-table-column"),o=(0,n.up)("el-button"),u=(0,n.up)("el-table");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n.Wm)(u,{data:r.items},{default:(0,n.w5)((()=>[(0,n.Wm)(s,{prop:"url",label:"",width:"90"},{default:(0,n.w5)((e=>[(0,n._)("img",{class:"media-item-image",src:e.row.url},null,8,k)])),_:1}),(0,n.Wm)(s,{prop:"label",label:"名称"}),(0,n.Wm)(s,{prop:"content_type",label:"类型"}),(0,n.Wm)(s,{prop:"size",label:"大小"}),(0,n.Wm)(s,{label:"操作"},{default:(0,n.w5)((e=>[(0,n.Wm)(o,{link:"",type:"danger",onClick:t=>r.handleClickRemoveItem(e.row)},{default:(0,n.w5)((()=>[(0,n.Uk)("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])])}var W=a(2655),U={name:"settings-mediae-table",computed:{items(){return this.$store.getters["media/list"]}},methods:{handleClickRemoveItem(e){let t="移除媒体文件",a="确定要移除 ["+e.name+"] 这个媒体文件吗？",n="注意：移除该文件可能会导致引用它的内容显示不正常！";W.T.confirm(a+n,t,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.removeItem(e)})).catch((()=>{}))},removeItem(e){this.$store.dispatch("media/remove",{item:e})}}};const y=(0,g.Z)(U,[["render",C],["__scopeId","data-v-5429b3e2"]]);var z=y,S=(a(7658),a(7178));const I=["src"];function x(){}const D={name:"update-up-dialog",data(){return{imageUrl:"",vo:{},item:{},fileprops:[{name:"",value:""}]}},methods:{handleAvatarSuccess(e,t){x(e);let a=e,n=a.mediae[0];this.vo=a,this.item=n,this.fileprops=this.makeFileProps(n),this.imageUrl=URL.createObjectURL(t.raw)},makeFileProps(e){const t={name:"文件名",size:"大小",content_type:"类型",sha256sum:"SHA-256"};let a=[];for(var n in t){let l=t[n],i=e[n];a.push({name:l,value:i})}return a},beforeAvatarUpload(e){return this.acceptType(e.type)?!(e.size/1024/1024>2)||(S.z8.error("文件太大了，最多支持 2MB!"),!1):(S.z8.error("不支持的文件格式!"),console.warn("不支持的文件格式: "+e.type),!1)},acceptType(e){const t=["image/jpeg","image/png","image/gif","image/svg","image/webp","image/svg+xml"];for(var a in t){let n=t[a];if(n==e)return!0}return!1},save(){let e=this.item;this.$store.dispatch("media/insert",{item:e}).then((()=>{this.close()}))},cancel(){this.close()},close(){this.$emit("update:modelValue",!1)}}};var P=Object.assign(D,{setup(e){return(e,t)=>{const a=(0,n.up)("el-icon"),l=(0,n.up)("el-upload"),i=(0,n.up)("el-col"),r=(0,n.up)("el-table-column"),s=(0,n.up)("el-table"),o=(0,n.up)("el-row"),m=(0,n.up)("el-button"),p=(0,n.up)("el-dialog");return(0,n.wg)(),(0,n.j4)(p,{title:"上传图片"},{default:(0,n.w5)((()=>[(0,n.Wm)(o,null,{default:(0,n.w5)((()=>[(0,n.Wm)(i,{span:12},{default:(0,n.w5)((()=>[(0,n.Wm)(l,{class:"avatar-uploader up-box",action:"/upload",drag:"","show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload},{default:(0,n.w5)((()=>[e.imageUrl?((0,n.wg)(),(0,n.iD)("img",{key:0,src:e.imageUrl,class:"avatar"},null,8,I)):((0,n.wg)(),(0,n.j4)(a,{key:1,class:"avatar-uploader-icon"},{default:(0,n.w5)((()=>[(0,n.Wm)((0,u.SU)(d.v37))])),_:1}))])),_:1},8,["on-success","before-upload"])])),_:1}),(0,n.Wm)(i,{span:12},{default:(0,n.w5)((()=>[(0,n.Wm)(s,{class:"up-box",data:e.fileprops,border:""},{default:(0,n.w5)((()=>[(0,n.Wm)(r,{prop:"name",label:"属性"}),(0,n.Wm)(r,{prop:"value",label:"值"})])),_:1},8,["data"])])),_:1})])),_:1}),(0,n._)("div",null,[(0,n.Wm)(m,{type:"success",onClick:e.save},{default:(0,n.w5)((()=>[(0,n.Uk)(" 保存 ")])),_:1},8,["onClick"]),(0,n.Wm)(m,{type:"default",onClick:e.cancel},{default:(0,n.w5)((()=>[(0,n.Uk)(" 取消 ")])),_:1},8,["onClick"])])])),_:1})}}});const T=(0,g.Z)(P,[["__scopeId","data-v-7061dd8c"]]);var A=T,M={name:"settings-mediae-index",components:{MyToolbar:f,MyTable:z,MyUpImageDialog:A,MyPager:_},data(){return{displayUploadDialog:!1}},methods:{fetch(){this.$store.dispatch("media/fetch",{all:1})},upload(){this.displayUploadDialog=!0},importPresets(){this.$store.dispatch("media/import_presets",{})},handleAction(e){let t=e.name;"refresh"==t?this.fetch():"import-presets"==t?this.importPresets():"insert"==t&&this.upload()}},mounted(){this.fetch()}};const $=(0,g.Z)(M,[["render",o],["__scopeId","data-v-4e7e347c"]]);var j=$,V={name:"SettingsMediaeView",components:{ClientViewIndex:j}};const Z=(0,g.Z)(V,[["render",l]]);var R=Z}}]);
//# sourceMappingURL=48.54404193.js.map