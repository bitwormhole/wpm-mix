"use strict";(self["webpackChunkwpm_station_vue"]=self["webpackChunkwpm_station_vue"]||[]).push([[568],{2997:function(e,t,l){l.d(t,{Z:function(){return g}});var a=l(3396),i=l(4870),n=l(9242),d=l(7139),o=l(2748);const s=["title"],r={class:"state-text"},u={ready:{type:"success",text:"正常"},moved:{type:"warn",text:"已搬迁"},offline:{type:"error",text:"找不到"}},c={name:"file-state",computed:{stateText(){return this.stringifyState(this.code)},statetype(){return this.getStateType(this.code)}},data(){return{}},methods:{stringifyState(e){let t=u[e];return null==t?e:t.text},getStateType(e){let t=u[e];return null==t?e:t.type}},props:{code:String}};var m=Object.assign(c,{setup(e){return(t,l)=>{const u=(0,a.up)("el-icon");return(0,a.wg)(),(0,a.iD)("div",{title:e.code},[(0,a.wy)((0,a.Wm)(u,{class:"state-icon-ok"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(o.c5o))])),_:1},512),[[n.F8,"success"==t.statetype]]),(0,a._)("span",r,(0,d.zw)(t.stateText),1),(0,a.wy)((0,a.Wm)(u,{class:"state-icon-warn"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(o.hg5))])),_:1},512),[[n.F8,"warn"==t.statetype]]),(0,a.wy)((0,a.Wm)(u,{class:"state-icon-error"},{default:(0,a.w5)((()=>[(0,a.Wm)((0,i.SU)(o.Tw$))])),_:1},512),[[n.F8,"error"==t.statetype]])],8,s)}}}),p=l(89);const h=(0,p.Z)(m,[["__scopeId","data-v-39ae21a4"]]);var g=h},3380:function(e,t,l){l.r(t),l.d(t,{default:function(){return pe}});var a=l(3396);function i(e,t,l,i,n,d){const o=(0,a.up)("MyClient"),s=(0,a.up)("AdminFrame");return(0,a.wg)(),(0,a.j4)(s,null,{default:(0,a.w5)((()=>[(0,a.Wm)(o)])),_:1})}const n=e=>((0,a.dD)("data-v-c915bc5e"),e=e(),(0,a.Cn)(),e),d={class:"settings-index-page"},o=n((()=>(0,a._)("h1",null,"应用程序",-1)));function s(e,t,l,i,n,s){const r=(0,a.up)("MyToolbar"),u=(0,a.up)("MySearch"),c=(0,a.up)("MyPager"),m=(0,a.up)("MyTable"),p=(0,a.up)("MyEdit");return(0,a.wg)(),(0,a.iD)("div",d,[o,(0,a.Wm)(r,{onAction:s.handleAction},null,8,["onAction"]),(0,a.Wm)(u,{class:"search-box"}),(0,a.Wm)(c,{class:"pager-box"}),(0,a.Wm)(m,{onAction:s.handleAction},null,8,["onAction"]),(0,a.Wm)(p,{method:"POST",enabled:n.theAddEnabled,"onUpdate:enabled":t[0]||(t[0]=e=>n.theAddEnabled=e),item:n.theAddItem,"onUpdate:item":t[1]||(t[1]=e=>n.theAddItem=e)},null,8,["enabled","item"]),(0,a.Wm)(p,{method:"PUT",enabled:n.theEditEnabled,"onUpdate:enabled":t[2]||(t[2]=e=>n.theEditEnabled=e),item:n.theEditItem,"onUpdate:item":t[3]||(t[3]=e=>n.theEditItem=e)},null,8,["enabled","item"])])}const r=["src"],u={class:"operation-buttons"};function c(e,t,l,i,n,d){const o=(0,a.up)("el-table-column"),s=(0,a.up)("FileStateView"),c=(0,a.up)("el-button"),m=(0,a.up)("el-table");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a.Wm)(m,{data:d.items},{default:(0,a.w5)((()=>[(0,a.Wm)(o,{label:"",width:"48px"},{default:(0,a.w5)((e=>[(0,a._)("img",{class:"item-icon-img",src:e.row.icon},null,8,r)])),_:1}),(0,a.Wm)(o,{label:"名称",prop:"name"}),(0,a.Wm)(o,{label:"标题",prop:"title"}),(0,a.Wm)(o,{label:"状态",prop:"state"},{default:(0,a.w5)((e=>[(0,a.Wm)(s,{code:e.row.state},null,8,["code"])])),_:1}),(0,a.Wm)(o,{label:"操作"},{default:(0,a.w5)((e=>[(0,a._)("div",u,[(0,a.Wm)(c,{type:"primary",link:"",onClick:t=>d.handleClickItemDetail(e.row)},{default:(0,a.w5)((()=>[(0,a.Uk)("详情")])),_:2},1032,["onClick"]),(0,a.Wm)(c,{type:"primary",link:"",onClick:t=>d.handleClickEditItem(e.row)},{default:(0,a.w5)((()=>[(0,a.Uk)("编辑")])),_:2},1032,["onClick"]),(0,a.Wm)(c,{type:"danger",link:"",onClick:t=>d.handleClickRemoveItem(e.row)},{default:(0,a.w5)((()=>[(0,a.Uk)("移除")])),_:2},1032,["onClick"])])])),_:1})])),_:1},8,["data"])])}var m=l(2655),p=l(2997),h={name:"settings-executables-table",components:{FileStateView:p.Z},computed:{items(){return this.$store.getters["executable/currentPageItems"]}},methods:{handleClickRemoveItem(e){let t="移除应用程序",l="确定要移除 ["+e.name+"] 这个应用程序吗？",a="该操作不会把磁盘上安装的程序卸载或删除，仅将对它的引用从WPM数据库中移除。";m.T.confirm(l+a,t,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.removeItem(e)})).catch((()=>{}))},handleClickEditItem(e){let t="edit",l={name:t,item:e};this.$emit("action",l)},handleClickItemDetail(e){let t="detail",l={name:t,item:e};this.$emit("action",l)},removeItem(e){let t=e.id;this.$store.dispatch("executable/remove",t)}}},g=l(89);const b=(0,g.Z)(h,[["render",c],["__scopeId","data-v-675c2a30"]]);var C=b;function w(e,t,l,i,n,d){const o=(0,a.up)("el-pagination");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a.Wm)(o,{"current-page":n.currentPage,"onUpdate:currentPage":t[0]||(t[0]=e=>n.currentPage=e),"page-size":n.pageSize,"onUpdate:pageSize":t[1]||(t[1]=e=>n.pageSize=e),"page-sizes":[5,10,20,50,100,200,500],background:n.background,layout:"total, sizes, prev, pager, next",total:d.theCountItemsTotal,onSizeChange:d.handleSizeChange,onCurrentChange:d.handleCurrentChange},null,8,["current-page","page-size","background","total","onSizeChange","onCurrentChange"])])}var k={name:"settings-executables-pager",computed:{items(){return[]},theCountItemsTotal(){return this.$store.getters["executable/total"]}},data(){return{currentPage:1,pageSize:10,background:!0}},methods:{handleSizeChange(e){let t=e;this.$store.commit("executable/update",{size:t})},handleCurrentChange(e){let t=e-1;this.$store.commit("executable/update",{index:t})},init(){let e={index:this.currentPage-1,size:this.pageSize,filter:""};this.$store.commit("executable/update",e)}},mounted(){this.init()}};const y=(0,g.Z)(k,[["render",w]]);var f=y,_=l(4870),v=l(2748);const W={name:"settings-executables-table",computed:{},data(){return{searchtext:""}},methods:{applyFilter(e){this.searchtext=e,this.$store.commit("executable/update",{filter:e})}}};var S=Object.assign(W,{setup(e){return(e,t)=>{const l=(0,a.up)("el-icon"),i=(0,a.up)("el-button"),n=(0,a.up)("el-input");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a.Wm)(n,{modelValue:e.searchtext,onInput:e.applyFilter,clearable:"",placeholder:"请输入要查找的内容"},{append:(0,a.w5)((()=>[(0,a.Wm)(i,{title:"查找"},{default:(0,a.w5)((()=>[(0,a.Wm)(l,null,{default:(0,a.w5)((()=>[(0,a.Wm)((0,_.SU)(v.olm))])),_:1})])),_:1})])),_:1},8,["modelValue","onInput"])])}}});const x=S;var I=x;const U={class:"toolbar"},D={name:"settings-local-repositories-toolbar",data(){return{}},methods:{fetch(){this.$store.dispatch("executable/fetch",{})},handleClickAdd(){let e={name:"add"};this.$emit("action",e)},handleClickRefresh(){this.fetch()}},mounted(){this.fetch()}};var z=Object.assign(D,{setup(e){return(e,t)=>{const l=(0,a.up)("el-icon"),i=(0,a.up)("el-button");return(0,a.wg)(),(0,a.iD)("div",U,[(0,a.Wm)(i,{onClick:e.handleClickRefresh,title:"刷新"},{default:(0,a.w5)((()=>[(0,a.Wm)(l,null,{default:(0,a.w5)((()=>[(0,a.Wm)((0,_.SU)(v.hYj))])),_:1})])),_:1},8,["onClick"]),(0,a.Wm)(i,{onClick:e.handleClickAdd,title:"添加本地仓库"},{default:(0,a.w5)((()=>[(0,a.Wm)(l,null,{default:(0,a.w5)((()=>[(0,a.Wm)((0,_.SU)(v.v37))])),_:1})])),_:1},8,["onClick"])])}}});const V=(0,g.Z)(z,[["__scopeId","data-v-1d69e6dd"]]);var E=V,F=l(9242);function T(e,t,l,i,n,d){const o=(0,a.up)("el-option"),s=(0,a.up)("el-select");return(0,a.wg)(),(0,a.j4)(s,null,{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.options,(e=>((0,a.wg)(),(0,a.j4)(o,{key:e.id,value:e.value,label:e.text},null,8,["value","label"])))),128)),(0,a.Wm)(o,{value:0,label:"不使用"})])),_:1})}l(7658);var M={name:"open-with-priority-selector",data(){const e=6;let t=[];for(let l=1;l<=e;l++){let a={id:l,value:e+2-l,text:""+l};t.push(a)}return{options:t}}};const $=(0,g.Z)(M,[["render",T]]);var P=$,A=l(1128);function O(e,t,l,i,n,d){const o=(0,a.up)("MySelector"),s=(0,a.up)("el-button"),r=(0,a.up)("el-dialog");return(0,a.wg)(),(0,a.j4)(r,{title:"选择图片"},{default:(0,a.w5)((()=>[(0,a.Wm)(o,{class:"",onChange:d.handleSelectionChange},null,8,["onChange"]),(0,a._)("div",null,[(0,a.Wm)(s,{type:"primary",onClick:d.onok},{default:(0,a.w5)((()=>[(0,a.Uk)("确定")])),_:1},8,["onClick"]),(0,a.Wm)(s,{type:"default",onClick:d.cancel},{default:(0,a.w5)((()=>[(0,a.Uk)("取消")])),_:1},8,["onClick"])])])),_:1})}var Z=l(7139);const j=e=>((0,a.dD)("data-v-9bb3daa0"),e=e(),(0,a.Cn)(),e),B=j((()=>(0,a._)("div",{class:"searchbox"},null,-1))),R={class:"pager"},K={class:"item-list"},Y={class:"list"},H=["title","onClick"],q=["src"],G={class:"item-text"};function J(e,t,l,i,n,d){const o=(0,a.up)("el-pagination");return(0,a.wg)(),(0,a.iD)("div",null,[B,(0,a._)("div",R,[(0,a.Wm)(o,{"current-page":n.currentPage,"onUpdate:currentPage":t[0]||(t[0]=e=>n.currentPage=e),"page-size":n.pageSize,"onUpdate:pageSize":t[1]||(t[1]=e=>n.pageSize=e),"page-sizes":[5,10,20,50,100,200,500],background:n.background,layout:"total, sizes, prev, pager, next",total:d.theCountItemsTotal,onSizeChange:d.handleSizeChange,onCurrentChange:d.handleCurrentChange},null,8,["current-page","page-size","background","total","onSizeChange","onCurrentChange"])]),(0,a._)("div",K,[(0,a._)("ul",Y,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(d.items,(e=>((0,a.wg)(),(0,a.iD)("li",{class:"item",key:e.id,title:e.name,style:(0,Z.j5)(d.computeItemStyle(e)),onClick:t=>d.handleClickItem(e)},[(0,a._)("img",{class:"item-image",src:e.url},null,8,q),(0,a._)("div",G,(0,Z.zw)(e.label),1)],12,H)))),128))])])])}var L={name:"media-selector",computed:{items(){return this.$store.getters["media/list"]},theCountItemsTotal(){return this.$store.getters["media/total"]}},data(){return{selectedId:0,selectedItem:{},currentPage:1,pageSize:10,background:!0}},methods:{handleClickItem(e){this.selectedId=e.id,this.selectedItem=e,this.$emit("change",e)},computeItemStyle(e){let t=e.id==this.selectedId,l={};return t&&(l.borderWidth="3px",l.borderColor="rgb(61, 139, 255)"),l},fetch(){this.$store.dispatch("lazy/load_mediae")},handleSizeChange(e){let t=e,l=0;this.$store.commit("media/update",{index:l,size:t})},handleCurrentChange(e){let t=e-1;this.$store.commit("media/update",{index:t})}},mounted(){this.fetch()}};const N=(0,g.Z)(L,[["render",J],["__scopeId","data-v-9bb3daa0"]]);var Q=N,X={name:"media-selector-dialog",components:{MySelector:Q},data(){return{item:{}}},methods:{handleSelectionChange(e){null!=e&&(this.item=e)},onok(){let e=this.item,t=e.id;t<1||(this.$emit("change",e),this.close())},cancel(){this.close()},close(){this.$emit("update:modelValue",!1)}}};const ee=(0,g.Z)(X,[["render",O]]);var te=ee;const le=["src"],ae={class:"tip-bad-path"},ie={name:"settings-executables-item-add",components:{OpenWithPrioritySel:P,OpenFileDialog:A.Z,MediaSelectorDialog:te},computed:{isModeAdd(){let e=(this.method+"").toUpperCase();return"POST"==e},isModeEdit(){let e=(this.method+"").toUpperCase();return"PUT"==e},theDialogTitle(){return this.isModeAdd?"添加应用":"修改应用"}},data(){return{item1:{id:0,name:"",title:"",path:"",description:""},displayDialog:!1,displayTipForBadPath:!1,displayOpenFileDialog:!1,displayMediaSelectorDialog:!1}},methods:{handleClickCancel(){this.displayDialog=!1},handleClickOK(){let e=this.item1,t="executable/";this.isModeAdd?t+="insert":this.isModeEdit&&(t+="update"),this.$store.dispatch(t,e).then((()=>{this.displayDialog=!1}))},handleClickBrowse(){this.displayOpenFileDialog=!0},handleClickFind(){let e=this.item1.name;this.prepareInsert({name:e})},handleOpenExeFiles(e){if(null==e)return;let t=null;for(var l in e){let a=e[l];t=a.path;break}if(null==t)return;let a=this.item1;a.path=t,this.prepareInsert(a)},handleImageSelected(e){let t=e.url;this.item1.icon=t},prepareInsert(e){null!=e&&this.$store.dispatch("executable/prepareInsert",e).then((e=>{this.handleFindResult(e.data)}))},handleFindResult(e){let t=e.executables,l=t[0];if(l.ready&&l.size>0&&""!=l.sha256sum)return this.item1.name=l.name,this.item1.title=l.title,this.item1.path=l.path,void(this.displayTipForBadPath=!1);this.displayTipForBadPath=!0},handleClickEditIcon(){console.log("todo: handleClickEditIcon"),this.displayMediaSelectorDialog=!0}},mounted(){},props:{enabled:Boolean,item:Object,method:String},watch:{displayDialog(e){this.$emit("update:enabled",e)},enabled(e){this.displayDialog=e},item(e){this.item1=e}}};var ne=Object.assign(ie,{setup(e){return(e,t)=>{const l=(0,a.up)("el-icon"),i=(0,a.up)("el-button"),n=(0,a.up)("el-input"),d=(0,a.up)("el-form-item"),o=(0,a.up)("el-form"),s=(0,a.up)("el-dialog");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a.Wm)(s,{modelValue:e.displayDialog,"onUpdate:modelValue":t[6]||(t[6]=t=>e.displayDialog=t),title:e.theDialogTitle},{default:(0,a.w5)((()=>[(0,a._)("div",null,[(0,a._)("img",{class:"exe-icon-image",src:e.item1.icon,title:"修改",onClick:t[0]||(t[0]=(...t)=>e.handleClickEditIcon&&e.handleClickEditIcon(...t))},null,8,le)]),(0,a.Wm)(o,{"label-width":"150px"},{default:(0,a.w5)((()=>[(0,a.Wm)(d,{label:"名称"},{default:(0,a.w5)((()=>[(0,a.Wm)(n,{modelValue:e.item1.name,"onUpdate:modelValue":t[1]||(t[1]=t=>e.item1.name=t)},{append:(0,a.w5)((()=>[(0,a.Wm)(i,{class:"btn-find",onClick:e.handleClickFind},{default:(0,a.w5)((()=>[(0,a.Wm)(l,null,{default:(0,a.w5)((()=>[(0,a.Wm)((0,_.SU)(v.olm))])),_:1}),(0,a.Uk)(" 查找")])),_:1},8,["onClick"])])),_:1},8,["modelValue"])])),_:1}),(0,a.Wm)(d,{label:"路径"},{default:(0,a.w5)((()=>[(0,a.Wm)(n,{modelValue:e.item1.path,"onUpdate:modelValue":t[2]||(t[2]=t=>e.item1.path=t)},{append:(0,a.w5)((()=>[(0,a.Wm)(i,{onClick:e.handleClickBrowse},{default:(0,a.w5)((()=>[(0,a.Uk)(" 浏览... ")])),_:1},8,["onClick"])])),_:1},8,["modelValue"]),(0,a.wy)((0,a._)("div",ae," 错误的路径！ ",512),[[F.F8,e.displayTipForBadPath]])])),_:1}),(0,a.Wm)(d,{label:"标题"},{default:(0,a.w5)((()=>[(0,a.Wm)(n,{modelValue:e.item1.title,"onUpdate:modelValue":t[3]||(t[3]=t=>e.item1.title=t)},null,8,["modelValue"])])),_:1}),(0,a.Wm)(d,{label:"排列顺序"},{default:(0,a.w5)((()=>[(0,a.Wm)(P,{modelValue:e.item1.open_with_priority,"onUpdate:modelValue":t[4]||(t[4]=t=>e.item1.open_with_priority=t)},null,8,["modelValue"])])),_:1}),(0,a.Wm)(d,{label:"说明"},{default:(0,a.w5)((()=>[(0,a.Wm)(n,{type:"textarea",modelValue:e.item1.description,"onUpdate:modelValue":t[5]||(t[5]=t=>e.item1.description=t)},null,8,["modelValue"])])),_:1})])),_:1}),(0,a._)("div",null,[(0,a.Wm)(i,{type:"success",onClick:e.handleClickOK},{default:(0,a.w5)((()=>[(0,a.Uk)("保存")])),_:1},8,["onClick"]),(0,a.Wm)(i,{type:"default",onClick:e.handleClickCancel},{default:(0,a.w5)((()=>[(0,a.Uk)("取消")])),_:1},8,["onClick"])])])),_:1},8,["modelValue","title"]),(0,a.Wm)(A.Z,{modelValue:e.displayOpenFileDialog,"onUpdate:modelValue":t[7]||(t[7]=t=>e.displayOpenFileDialog=t),onOpenFile:e.handleOpenExeFiles},null,8,["modelValue","onOpenFile"]),(0,a.Wm)(te,{modelValue:e.displayMediaSelectorDialog,"onUpdate:modelValue":t[8]||(t[8]=t=>e.displayMediaSelectorDialog=t),onChange:e.handleImageSelected},null,8,["modelValue","onChange"])])}}});const de=(0,g.Z)(ne,[["__scopeId","data-v-342e0c1c"]]);var oe=de,se={name:"settings-executables",components:{MyTable:C,MyPager:f,MySearch:I,MyToolbar:E,MyEdit:oe},data(){return{theAddItem:{},theAddEnabled:!1,theEditItem:{},theEditEnabled:!1}},methods:{handleAction(e){let t=e.name;"edit"==t?this.edit(e.item):"add"==t&&this.add()},add(){this.theAddItem={},this.theAddEnabled=!0},edit(e){this.theEditItem=e,this.theEditEnabled=!0}}};const re=(0,g.Z)(se,[["render",s],["__scopeId","data-v-c915bc5e"]]);var ue=re,ce={name:"settings-executables",components:{MyClient:ue}};const me=(0,g.Z)(ce,[["render",i]]);var pe=me}}]);
//# sourceMappingURL=568.a2d81514.js.map