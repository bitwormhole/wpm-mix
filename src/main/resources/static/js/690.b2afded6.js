"use strict";(self["webpackChunkwpm_station_vue"]=self["webpackChunkwpm_station_vue"]||[]).push([[690],{9466:function(e,t){function l(e,t){let l=e+"";if(e<0)return l;if(null==t)return l;if(t<2)return l;for(;l.length<t;)l="0"+l;return l}function n(e,t){null==e&&(e=0);let l=new Date;return l.setTime(e),i(l,t)}function i(e,t){let n=e;null==n&&(n=new Date,n.setTime(0));let i=n.getFullYear(),a=n.getMonth()+1,o=n.getDate(),r=n.getHours(),s=n.getMinutes(),u=n.getSeconds(),m="",d="",h="",c=!1,p=!1;if("date"==t?c=!0:"time"==t?p=!0:(c=!0,p=!0,m="  "),c){let e=""+i,t=l(a,2),n=l(o,2);d=e+"-"+t+"-"+n}if(p){let e=l(r,2),t=l(s,2),n=l(u,2);h=e+":"+t+":"+n}return d+m+h}t["Z"]={name:"TimeJS",StringifyTimestamp:n,StringifyDate:i}},5690:function(e,t,l){l.d(t,{Z:function(){return F}});var n=l(3396);function i(e,t,l,i,a,o){const r=(0,n.up)("MyDialogCommon");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n.Wm)(r,{modelValue:l.modelValue,bank:"dialog_open",multipleSelection:l.multipleSelection,"onUpdate:modelValue":o.updateModelValue,onOpenFile:o.handleOpenFile},null,8,["modelValue","multipleSelection","onUpdate:modelValue","onOpenFile"])])}var a=l(4870),o=l(7139),r=l(2748),s=(l(7658),l(9242));const u={class:"mode-elements"},m={class:"mode-input"},d={name:"filebrowser-path-bar",computed:{items(){return this.makeItems(this.elements)},elements(){return this.$store.getters["files/GetPathElements"](this.bank)}},data(){return{mode:{current:2,edit:1,elements:2},pathText:""}},methods:{handleClickEdit(){let e=this.bank,t=this.$store.getters["files/GetPathString"](e);null==t&&(t=""),this.pathText=t,this.mode.current=this.mode.edit},handleClickGo(){this.mode.current=this.mode.elements,this.navTo(this.pathText)},handleClickCancel(){this.mode.current=this.mode.elements},handleClickPathItem(e){let t=e.path;this.navTo(t)},handleClickPathRoot(){this.navTo("/")},makeItems(e){let t=[],l="";for(var n in e){let i=e[n],a=this.makeItem(i,l);t.push(a),l=a.path}return t},makeItem(e,t){let l={};return l.path=t+"/"+e,l.name=e,l},navTo(e){let t=this.bank;this.$store.dispatch("files/fetch",{bank:t,path:e})}},props:{bank:String}};var h=Object.assign(d,{setup(e){return(e,t)=>{const l=(0,n.up)("el-button"),i=(0,n.up)("el-breadcrumb-item"),d=(0,n.up)("el-breadcrumb"),h=(0,n.up)("el-icon"),c=(0,n.up)("el-input");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n.wy)((0,n._)("div",u,[(0,n.Wm)(d,{class:"mode-elements-bread","separator-icon":(0,a.SU)(r.olP)},{default:(0,n.w5)((()=>[(0,n.Wm)(i,null,{default:(0,n.w5)((()=>[(0,n.Wm)(l,{class:"path-element",link:"",type:"primary",onClick:e.handleClickPathRoot},{default:(0,n.w5)((()=>[(0,n.Uk)(" 根 ")])),_:1},8,["onClick"])])),_:1}),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.items,(t=>((0,n.wg)(),(0,n.j4)(i,{key:t.id},{default:(0,n.w5)((()=>[(0,n.Wm)(l,{class:"path-element",link:"",type:"primary",title:t.path,onClick:l=>e.handleClickPathItem(t)},{default:(0,n.w5)((()=>[(0,n.Uk)((0,o.zw)(t.name),1)])),_:2},1032,["title","onClick"])])),_:2},1024)))),128))])),_:1},8,["separator-icon"]),(0,n.Wm)(l,{link:"",onClick:e.handleClickEdit,title:"编辑路径"},{default:(0,n.w5)((()=>[(0,n.Wm)(h,null,{default:(0,n.w5)((()=>[(0,n.Wm)((0,a.SU)(r.I8b))])),_:1})])),_:1},8,["onClick"])],512),[[s.F8,e.mode.current==e.mode.elements]]),(0,n.wy)((0,n._)("div",m,[(0,n.Wm)(c,{modelValue:e.pathText,"onUpdate:modelValue":t[0]||(t[0]=t=>e.pathText=t),placeholder:"请输入要查询的路径"},{prepend:(0,n.w5)((()=>[(0,n.Wm)(l,{onClick:e.handleClickCancel,title:"取消"},{default:(0,n.w5)((()=>[(0,n.Wm)(h,null,{default:(0,n.w5)((()=>[(0,n.Wm)((0,a.SU)(r.q6s))])),_:1})])),_:1},8,["onClick"])])),append:(0,n.w5)((()=>[(0,n.Wm)(l,{onClick:e.handleClickGo,title:"查询"},{default:(0,n.w5)((()=>[(0,n.Wm)(h,null,{default:(0,n.w5)((()=>[(0,n.Wm)((0,a.SU)(r.O6d))])),_:1})])),_:1},8,["onClick"])])),_:1},8,["modelValue"])],512),[[s.F8,e.mode.current==e.mode.edit]])])}}}),c=l(89);const p=(0,c.Z)(h,[["__scopeId","data-v-44e24e86"]]);var f=p;function k(e,t,l,i,a,r){const s=(0,n.up)("el-table-column"),u=(0,n.up)("el-button"),m=(0,n.up)("el-table");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n.Wm)(m,{data:r.items,ref:"theTable","highlight-current-row":"",onSelectionChange:r.handleSelectionChange,onCurrentChange:r.handleCurrentChange},{default:(0,n.w5)((()=>[(0,n.Wm)(s,{type:r.tableColumnType},null,8,["type"]),(0,n.Wm)(s,{prop:"name",label:"名称",sortable:""},{default:(0,n.w5)((e=>[(0,n.Wm)(u,{link:"",type:"primary",onClick:t=>r.handleClickItemName(e.row)},{default:(0,n.w5)((()=>[(0,n.Uk)((0,o.zw)(e.row.name),1)])),_:2},1032,["onClick"])])),_:1}),(0,n.Wm)(s,{prop:"content_type",label:"类型",sortable:""}),(0,n.Wm)(s,{prop:"updated_at",label:"修改时间",formatter:r.formatTimestamp,sortable:""},null,8,["formatter"]),(0,n.Wm)(s,{prop:"size",label:"大小",formatter:r.formatByteSize,sortable:""},null,8,["formatter"])])),_:1},8,["data","onSelectionChange","onCurrentChange"])])}var C=l(9466);function b(e,t,l){let n=e/t;if(n<1)return null;let i="";return i=n<5?n.toFixed(1):n.toFixed(0),i+l}function g(e){const t=1024,l=1048576,n=1073741824;let i=b(e,n," GB");return null!=i?i:(i=b(e,l," MB"),null!=i?i:(i=b(e,t," KB"),null!=i?i:e+" B"))}var w={name:"BytesJS",StringifySize:g};function S(){}var _={name:"filebrowser-view-detail-table",computed:{items(){return this.$store.getters["files/GetItems"](this.bank)},tableColumnType(){return this.multipleSelection?"selection":"index"}},data(){return{selection1:{},selectionN:[]}},methods:{handleClickItemName(e){e.is_dir&&this.openDir(e)},openDir(e){let t=this.bank,l=e.name;this.$store.dispatch("files/fetch",{bank:t,href:l})},getFieldByName(e,t){return null==e||null==t?"":t[e]},handleCurrentChange(e){null!=e&&(this.selection1=e),this.fireSelectionChange()},handleSelectionChange(){let e=this.$refs.theTable.getSelectionRows();null!=e&&(this.selectionN=e),this.fireSelectionChange()},fireSelectionChange(){let e=this.selectionN,t=this.selection1,l=[];if(null!=e)for(var n in e)l.push(e[n]);0==l.length&&null!=t&&null!=t.name&&l.push(t),this.$emit("selection-change",l)},formatByteSize(e,t,l,n){return S(e,t,n),w.StringifySize(l)},formatTimestamp(e,t,l,n){return S(e,t,n),C.Z.StringifyTimestamp(l)}},props:{bank:String,multipleSelection:Boolean}};const v=(0,c.Z)(_,[["render",k]]);var W=v,y=l(2655);const T=e=>((0,n.dD)("data-v-2a3b2d19"),e=e(),(0,n.Cn)(),e),V={class:"toolbar toolbar-top"},U=T((()=>(0,n._)("div",{class:"toolbar toolbar-bottom"},null,-1))),D={name:"filebrowser-dialog-common",components:{MyPathBar:f,MyDetailView:W},computed:{dialogTitle(){let e=this.title;if(null!=e&&""!=e)return e;let t=this.actionText,l=this.wantText;return t+l},actionText(){let e=this.action;return"save"==e?"保存":"打开"},wantText(){let e=this.want;return"folder"==e||"directory"==e?"文件夹":"文件"}},data(){return{filename:"",selectedItems:[]}},methods:{refresh(){let e=this.bank;this.$store.dispatch("files/fetch",{bank:e})},updateModelValue(e){this.$emit("update:modelValue",e)},handleClickRefresh(){this.refresh()},handleClickGoUp(){let e=this.bank,t="..";this.$store.dispatch("files/fetch",{bank:e,href:t})},handleClickMakeDir(){let e="新建文件夹",t="请输入文件夹名称";y.T.prompt(t,e,{confirmButtonText:"确定",cancelButtonText:"取消"}).then((()=>{console.warn("todo: mkdir")})).catch((()=>{}))},handleClickCancel(){this.updateModelValue(!1)},handleClickOK(){this.updateModelValue(!1);let e=this.selectedItems;"save"==this.action?this.$emit("save-file",e):this.$emit("open-file",e)},handleSelectionChange(e){if(null==e)return;if(1==e.length)return this.filename=e[0].name,void(this.selectedItems=e);let t="",l="";for(var n in e){let i=e[n];l+=t+"'"+i.name+"'",t=", "}this.selectedItems=e,this.filename=l},init(){let e="/",t="file:///",l=this.bank;this.$store.commit("files/init",{bank:l,path:e,base:t})}},mounted(){this.init()},props:{modelValue:Boolean,bank:String,title:String,want:String,action:String,multipleSelection:Boolean},watch:{modelValue(e,t){1==e&&0==t&&this.refresh()}}};var B=Object.assign(D,{setup(e){return(t,l)=>{const i=(0,n.up)("el-icon"),s=(0,n.up)("el-button"),u=(0,n.up)("el-input"),m=(0,n.up)("el-dialog");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n.Wm)(m,{modelValue:e.modelValue,"onUpdate:modelValue":t.updateModelValue,width:"66%",fullscreen:!1,title:t.dialogTitle},{default:(0,n.w5)((()=>[(0,n.Wm)(f,{bank:e.bank},null,8,["bank"]),(0,n._)("div",V,[(0,n.Wm)(s,{onClick:t.handleClickGoUp},{default:(0,n.w5)((()=>[(0,n.Wm)(i,null,{default:(0,n.w5)((()=>[(0,n.Wm)((0,a.SU)(r.tYz))])),_:1}),(0,n.Uk)(" 向上 ")])),_:1},8,["onClick"]),(0,n.Wm)(s,{onClick:t.handleClickRefresh},{default:(0,n.w5)((()=>[(0,n.Wm)(i,null,{default:(0,n.w5)((()=>[(0,n.Wm)((0,a.SU)(r.hYj))])),_:1}),(0,n.Uk)(" 刷新")])),_:1},8,["onClick"]),(0,n.Wm)(s,{onClick:t.handleClickMakeDir},{default:(0,n.w5)((()=>[(0,n.Wm)(i,null,{default:(0,n.w5)((()=>[(0,n.Wm)((0,a.SU)(r.v37))])),_:1}),(0,n.Uk)(" 新建文件夹")])),_:1},8,["onClick"]),(0,n.Wm)(u,{class:"input-file-name",modelValue:t.filename,"onUpdate:modelValue":l[0]||(l[0]=e=>t.filename=e),placeholder:"文件(或目录)名"},null,8,["modelValue"]),(0,n.Wm)(s,{type:"success",onClick:t.handleClickOK},{default:(0,n.w5)((()=>[(0,n.Uk)((0,o.zw)(t.actionText),1)])),_:1},8,["onClick"]),(0,n.Wm)(s,{type:"default",onClick:t.handleClickCancel},{default:(0,n.w5)((()=>[(0,n.Uk)("取消")])),_:1},8,["onClick"])]),(0,n.Wm)(W,{bank:e.bank,onSelectionChange:t.handleSelectionChange},null,8,["bank","onSelectionChange"]),U])),_:1},8,["modelValue","onUpdate:modelValue","title"])])}}});const I=(0,c.Z)(B,[["__scopeId","data-v-2a3b2d19"]]);var x=I,M={name:"filebrowser-dialog-open",components:{MyDialogCommon:x},methods:{updateModelValue(e){this.$emit("update:modelValue",e)},handleOpenFile(e){this.$emit("open-file",e)}},props:{modelValue:Boolean,multipleSelection:Boolean}};const $=(0,c.Z)(M,[["render",i]]);var F=$}}]);
//# sourceMappingURL=690.b2afded6.js.map